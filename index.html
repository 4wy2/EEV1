<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <title>YIC Smart Exams - PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.7/dayjs.min.js"></script>

    <style>
        :root { --primary: #8042ff; --accent: #1fc47c; --danger: #ff4d6d; --card-bg: rgba(13, 23, 56, 0.7); }
        body { margin: 0; background: #050816; font-family: 'Tajawal', sans-serif; color: white; overflow-x: hidden; }
        
        .bg-blobs { position: fixed; width: 100vw; height: 100vh; z-index: -1; overflow: hidden; }
        .blob { position: absolute; filter: blur(80px); border-radius: 50%; opacity: 0.1; animation: move 20s infinite alternate; }
        @keyframes move { from { transform: translate(0, 0); } to { transform: translate(100px, 100px); } }

        .app { width: min(920px, 98%); margin: 15px auto; background: var(--card-bg); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 25px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }

        .countdown-bar { background: linear-gradient(90deg, var(--danger), var(--primary)); padding: 10px; text-align: center; font-weight: bold; display: none; font-size: 12px; }

        .section-title { padding: 15px 15px 5px; font-size: 14px; color: var(--primary); font-weight: 800; display: flex; align-items: center; gap: 8px; }
        .section-title::after { content: ""; flex: 1; height: 1px; background: rgba(255,255,255,0.1); }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØµÙ - ØªÙˆØ²ÙŠØ¹ Ø£ÙÙ‚ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .row { 
            display: flex; 
            flex-direction: row; 
            align-items: center; 
            padding: 12px 10px; 
            margin: 8px 10px; 
            background: rgba(255,255,255,0.03); 
            border-radius: 15px; 
            border: 1px solid rgba(255,255,255,0.05); 
            gap: 5px;
            transition: 0.3s;
        }

        /* Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        .data-item { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center; 
            flex: 1; 
            min-width: 0; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªØ¯Ø§Ø®Ù„ */
        }

        .info-group { flex: 1.4; align-items: flex-start; text-align: right; }

        .caption { font-size: 9px; color: #5d78ff; font-weight: bold; margin-bottom: 4px; opacity: 0.9; }
        .course-code { font-weight: 800; color: #ffd166; font-size: 13px; }
        .val-text { font-weight: 700; font-size: 11px; white-space: nowrap; }

        .actions-cell { display: flex; gap: 5px; flex: 0.5; justify-content: flex-end; }
        .btn-action { border: none; width: 30px; height: 30px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; transition: 0.2s; }
        .btn-save { background: rgba(255, 77, 109, 0.1); color: var(--danger); border: 1px solid rgba(255, 77, 109, 0.2); }
        .btn-save.saved { background: var(--danger); color: white; border: none; }
        .btn-cal { background: rgba(31, 196, 124, 0.1); color: var(--accent); border: 1px solid rgba(31, 196, 124, 0.2); }

        .search-wrapper { padding: 25px 15px; text-align: center; }
        .search-wrapper input { width: 100%; max-width: 400px; padding: 12px 20px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); color: white; outline: none; font-size: 14px; }

        /* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØªØ­Ø¯ÙŠØ« */
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 10px 20px; border-radius: 50px; z-index: 9999; font-weight: bold; font-size: 12px; display: none; box-shadow: 0 5px 20px rgba(0,0,0,0.4); }

        @media (max-width: 500px) {
            .row { padding: 10px 6px; margin: 6px 8px; }
            .info-group { flex: 1.2; }
            .course-code { font-size: 11px; }
            .val-text { font-size: 9px; }
            .caption { font-size: 8px; }
            .actions-cell { flex-direction: column; flex: 0.3; align-items: center; }
            .btn-action { width: 26px; height: 26px; font-size: 10px; }
            .hide-mobile { display: none; }
        }
    </style>
</head>
<body>

    <div id="updateToast" class="toast"></div>

    <div class="bg-blobs">
        <div class="blob" style="width:300px; height:300px; background:var(--primary); top:-50px; right:-50px;"></div>
        <div class="blob" style="width:250px; height:250px; background:var(--accent); bottom:-30px; left:-30px;"></div>
    </div>

    <main class="app">
        <div id="countdown" class="countdown-bar"></div>

        <div class="search-wrapper">
            <h2 style="margin-bottom: 5px; font-weight: 900;">Ø¬Ø¯Ø§ÙˆÙ„ YIC Ø§Ù„Ø°ÙƒÙŠØ©</h2>
            <p style="font-size: 11px; opacity: 0.6; margin-bottom: 15px;">Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</p>
            <input id="studentId" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù…Ø² Ø£Ùˆ Ø§Ù„Ø§Ø³Ù…...">
        </div>

        <div id="myScheduleSection" style="display:none;">
            <div class="section-title"><i class="fa fa-star" style="color: #ffd166;"></i> Ø¬Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</div>
            <div id="myRows"></div>
        </div>

        <div class="section-title"><i class="fa fa-search"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</div>
        <div id="searchRows"></div>
    </main>

    <script>
        let allExams = [];
        let myExams = JSON.parse(localStorage.getItem('yic_saved_exams')) || [];

        async function init() {
            try {
                // Ø¥Ø¶Ø§ÙØ© Ù…ØªØºÙŠØ± Ø§Ù„ÙˆÙ‚Øª Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø£Ø­Ø¯Ø« Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¯Ø§Ø¦Ù…Ø§Ù‹
                const res = await fetch('exams_data.json?v=' + Date.now());
                const data = await res.json();
                allExams = data.exams_list;
                syncExams(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                renderMySchedule();
            } catch(e) { console.error("Error:", e); }
        }

        function syncExams() {
            let updated = false;
            myExams = myExams.map(saved => {
                const latest = allExams.find(e => e.code === saved.code);
                if (latest && (latest.date !== saved.date || latest.time !== saved.time)) {
                    updated = true;
                    return latest;
                }
                return saved;
            });
            if (updated) {
                localStorage.setItem('yic_saved_exams', JSON.stringify(myExams));
                showToast("ğŸ”” ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙÙŠ Ø¬Ø¯ÙˆÙ„Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ");
            }
        }

        function showToast(msg) {
            const t = document.getElementById('updateToast');
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 4000);
        }

        function createRow(ex, isSaved) {
            const row = document.createElement('div');
            row.className = 'row';
            row.innerHTML = `
                <div class="data-item info-group">
                    <span class="caption">Ø§Ù„Ù…Ø§Ø¯Ø©</span>
                    <span class="course-code">${ex.code}</span>
                    <span style="font-size:8px; opacity:0.5; white-space:nowrap; overflow:hidden;">${ex.course_name}</span>
                </div>
                <div class="data-item">
                    <span class="caption">Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
                    <span class="val-text">${ex.date.split(' ')[0]}</span>
                    <span style="font-size:8px; color:var(--accent)">${ex.date.split(' ')[1] || ''}</span>
                </div>
                <div class="data-item">
                    <span class="caption">Ø§Ù„ÙˆÙ‚Øª</span>
                    <span class="val-text" style="color:var(--danger)">${ex.time}</span>
                </div>
                <div class="data-item hide-mobile">
                    <span class="caption">Ø§Ù„Ù…Ø¯Ø©</span>
                    <span style="font-size:9px; background:rgba(255,255,255,0.1); padding:2px 4px; border-radius:4px;">${ex.duration}</span>
                </div>
                <div class="actions-cell">
                    <button class="btn-action btn-cal" onclick="addToCal('${ex.code}','${ex.date}','${ex.time}')"><i class="fa fa-calendar-plus"></i></button>
                    <button class="btn-action btn-save ${isSaved ? 'saved' : ''}" onclick="toggleSave('${ex.code}')"><i class="fa ${isSaved ? 'fa-trash-can' : 'fa-bookmark'}"></i></button>
                </div>
            `;
            return row;
        }

        function renderMySchedule() {
            const container = document.getElementById('myRows');
            const section = document.getElementById('myScheduleSection');
            if (myExams.length === 0) { section.style.display = 'none'; return; }
            section.style.display = 'block';
            container.innerHTML = '';
            myExams.sort((a,b) => a.date.localeCompare(b.date)).forEach(ex => container.appendChild(createRow(ex, true)));
            updateCountdown(myExams[0].date);
        }

        function toggleSave(code) {
            const idx = myExams.findIndex(e => e.code === code);
            if (idx > -1) myExams.splice(idx, 1);
            else myExams.push(allExams.find(e => e.code === code));
            localStorage.setItem('yic_saved_exams', JSON.stringify(myExams));
            renderMySchedule(); doSearch();
        }

        function doSearch() {
            const q = document.getElementById('studentId').value.trim().toUpperCase();
            const container = document.getElementById('searchRows');
            if (!q) { container.innerHTML = ''; return; }
            const filtered = allExams.filter(e => e.code.includes(q) || e.course_name.toUpperCase().includes(q));
            container.innerHTML = '';
            filtered.forEach(ex => container.appendChild(createRow(ex, myExams.some(s => s.code === ex.code))));
        }

        function updateCountdown(dateStr) {
            const datePart = dateStr.split(' ')[0];
            const [d, m, y] = datePart.split('-');
            const diff = dayjs(`${y}-${m}-${d}`).diff(dayjs().startOf('day'), 'day');
            const el = document.getElementById('countdown');
            el.style.display = 'block';
            if (diff > 0) el.innerHTML = `ğŸš€ Ù…ØªØ¨Ù‚ÙŠ ${diff} Ø£ÙŠØ§Ù… Ø¹Ù„Ù‰ Ø§Ø®ØªØ¨Ø§Ø±Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù… (${datePart})`;
            else if (diff === 0) el.innerHTML = `ğŸ”¥ Ø§Ø®ØªØ¨Ø§Ø±Ùƒ Ø§Ù„ÙŠÙˆÙ…! ÙƒÙ„ Ø§Ù„ØªÙˆÙÙŠÙ‚ (${datePart})`;
            else el.style.display = 'none';
        }

        function addToCal(code, dateStr, timeStr) {
            const d = dateStr.split(' ')[0].split('-').reverse().join('');
            window.open(`https://calendar.google.com/calendar/render?action=TEMPLATE&text=Ø§Ø®ØªØ¨Ø§Ø± ${code}&dates=${d}T080000/${d}T100000`, '_blank');
        }

        document.getElementById('studentId').addEventListener('input', doSearch);
        init();
    </script>
</body>
</html>
